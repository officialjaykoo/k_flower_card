import { ENGINE_MESSAGES } from "./engineMessages.js";

export const DEFAULT_LANGUAGE = "ko";
export const SUPPORTED_LANGUAGES = Object.freeze(["ko", "en"]);

const MESSAGES = {
  ko: {
    "model.heuristicV3": "휴리스틱 V3",
    "model.heuristicV4": "휴리스틱 V4",
    "model.heuristicV5": "휴리스틱 V5",
    "model.heuristicV6": "휴리스틱 V6",
    "model.heuristicV7": "휴리스틱 V7 Gold Digger",
    "model.neatPhase2Seed9": "NEAT Phase2 Seed9",
    "model.v14Moe": "모델 V14 자동",
    "model.v14Attack": "모델 V14 공격",
    "model.v14Defense": "모델 V14 수비",
    "player.player1": "플레이어1",
    "player.player2": "플레이어2",
    "replay.loadedSourceDefault": "불러온 기보",
    "board.turn.first": "선",
    "board.turn.second": "후",
    "board.badge.match": "매치",
    "board.captureState.aria": "획득패 상태",
    "board.captureState.shakeBomb": "흔들/폭탄",
    "board.captureState.ppuk": "뻑",
    "board.gold": "골드",
    "board.point": "{value}점",
    "board.roundMultiplier": "이번 판 X{value}",
    "board.opening.title": "첫 게임 선/후 결정 - 바닥패 1장 선택",
    "board.opening.myPick": "내 선택",
    "board.opening.opponentPick": "상대 선택",
    "board.opening.me": "나",
    "board.opening.opponent": "상대",
    "board.opening.starter": "선턴",
    "board.replay.title": "턴 리플레이",
    "board.replay.source": "소스",
    "board.replay.state": "상태",
    "board.replay.stateOn": "켜짐",
    "board.replay.stateOff": "꺼짐",
    "board.replay.frame": "프레임",
    "board.replay.actor": "행동자",
    "board.replay.action": "행동",
    "board.replay.event": "이벤트",
    "board.replay.btn.start": "리플레이 시작",
    "board.replay.btn.stop": "리플레이 종료",
    "board.replay.btn.prev": "이전 턴",
    "board.replay.btn.next": "다음 턴",
    "board.replay.btn.autoStart": "자동재생",
    "board.replay.btn.autoStop": "자동재생 정지",
    "board.replay.interval": "자동재생 간격",
    "board.replay.empty": "기보가 없어 리플레이를 시작할 수 없습니다.",
    "controls.alert.invalidReplay": "지원하지 않는 기보 형식입니다. 최신 형식(JSON object + kibo 배열)만 불러올 수 있습니다.",
    "controls.alert.invalidJson": "JSON 파싱에 실패했습니다. 파일 내용을 확인해 주세요.",
    "controls.alert.resetReplayOnly": "브라우저 저장은 사용하지 않습니다. 현재 불러온 기보만 초기화했습니다.",
    "controls.button.rules": "룰페이지 열기",
    "controls.button.cardGuide": "패보기",
    "controls.button.gameLog": "게임로그",
    "controls.mode.hva": "사람 vs AI",
    "controls.mode.hvh": "사람 vs 사람",
    "controls.mode.ava": "AI vs AI",
    "controls.button.startSpecified": "지정 게임시작",
    "controls.button.startRandom": "새 게임시작",
    "controls.button.loadReplay": "기보 불러오기",
    "controls.button.exportReplay": "기보 내보내기",
    "controls.button.resetReplay": "기보 초기화",
    "controls.speed": "진행 속도",
    "controls.speed.fast": "Fast (즉시)",
    "controls.speed.visual": "Visual (턴 애니메이션)",
    "controls.visualDelay": "Visual 지연",
    "controls.revealAiHand": "AI 패 공개",
    "controls.fixedHand": "손패고정",
    "controls.language": "언어",
    "controls.language.ko": "한국어",
    "controls.language.en": "English",
    "controls.cardTheme": "화투패",
    "controls.cardTheme.original": "오리지날",
    "controls.cardTheme.kFlower": "K-FLOWER",
    "overlay.notice": "알림",
    "overlay.revealMessage": "{player} {month}월 카드 공개",
    "overlay.selectCard.title": "카드 선택",
    "overlay.selectCard.defaultMessage": "보드 카드 1장을 선택하세요.",
    "overlay.remainingTime": "남은 시간: {seconds}초",
    "overlay.goStop.title": "Go / Stop 선택",
    "overlay.president.title": "대통령 선택",
    "overlay.president.stop": "10점 종료",
    "overlay.president.hold": "들고치기",
    "overlay.shaking.title": "흔들기 선택",
    "overlay.shaking.confirm": "{player}: 흔들기 선언할까요?",
    "overlay.yes": "예",
    "overlay.no": "아니요",
    "overlay.gukjin.title": "국진 선택",
    "overlay.gukjin.five": "열로 확정",
    "overlay.gukjin.junk": "쌍피로 확정",
    "overlay.roundEnd.title": "라운드 종료",
    "overlay.result.win": "{player} 승리",
    "overlay.result.draw": "무승부",
    "overlay.result.nagari": "나가리: {reasons}",
    "overlay.result.president": "대통령!",
    "overlay.result.normal": "일반 종료",
    "overlay.button.startSpecified": "같은패로 게임시작",
    "overlay.button.startRandom": "새 게임시작",
    "popup.blocked": "팝업이 차단되었습니다. 팝업 허용 후 다시 시도해 주세요.",
    "popup.cardGuide.title": "패보기",
    "popup.cardGuide.meta": "메인 패는 8장씩 표시됩니다. (1월 4장 + 2월 4장)",
    "popup.cardGuide.mainCards": "1~12월 기본패",
    "popup.cardGuide.bonusCards": "보너스 카드",
    "popup.rules.title": "룰요약",
    "popup.rules.meta": "README의 1~9번 섹션과 연동 표시됩니다.",
    "popup.rules.readmeFallback": "README 규칙 섹션(1~9)을 읽지 못했습니다.",
    "popup.gameLog.title": "게임로그",
    "popup.gameLog.meta": "현재 판 로그 {count}줄",
    "popup.gameLog.empty": "표시할 로그가 없습니다.",
    "popup.gameLog.hidden.starterCandidate": "\uC120\uACF5 \uD6C4\uBCF4:",
    "popup.gameLog.hidden.matchCapture": "\uB9E4\uCE58 \uCEA1\uCC98",
    "popup.gameLog.hidden.cardSelect": "\uCE74\uB4DC \uC120\uD0DD",
    "replay.action.initial": "초기 배분",
    "replay.action.pass": "패스",
    "replay.action.play": "카드 플레이 ({month}월 {name})",
    "replay.action.declareBomb": "폭탄 선언 ({month}월)",
    "replay.action.flipSelect": "뒤집기 선택 캡처 ({month}월)",
    "replay.action.unknown": "행동",
    "card.alt.defaultName": "카드",
    "card.alt.format": "{month}월 {name}"
  },
  en: {
    "model.heuristicV3": "Heuristic V3",
    "model.heuristicV4": "Heuristic V4",
    "model.heuristicV5": "Heuristic V5",
    "model.heuristicV6": "Heuristic V6",
    "model.heuristicV7": "Heuristic V7 Gold Digger",
    "model.neatPhase2Seed9": "NEAT Phase2 Seed9",
    "model.v14Moe": "Model V14 Auto",
    "model.v14Attack": "Model V14 Attack",
    "model.v14Defense": "Model V14 Defense",
    "player.player1": "Player 1",
    "player.player2": "Player 2",
    "replay.loadedSourceDefault": "Loaded Replay",
    "board.turn.first": "First",
    "board.turn.second": "Second",
    "board.badge.match": "Match",
    "board.captureState.aria": "Captured status",
    "board.captureState.shakeBomb": "Shake/Bomb",
    "board.captureState.ppuk": "Ppuk",
    "board.gold": "Gold",
    "board.point": "{value} pt",
    "board.roundMultiplier": "This round X{value}",
    "board.opening.title": "First game turn order - choose 1 board card",
    "board.opening.myPick": "My pick",
    "board.opening.opponentPick": "Opponent pick",
    "board.opening.me": "Me",
    "board.opening.opponent": "Opponent",
    "board.opening.starter": "Starter",
    "board.replay.title": "Turn Replay",
    "board.replay.source": "Source",
    "board.replay.state": "State",
    "board.replay.stateOn": "On",
    "board.replay.stateOff": "Off",
    "board.replay.frame": "Frame",
    "board.replay.actor": "Actor",
    "board.replay.action": "Action",
    "board.replay.event": "Events",
    "board.replay.btn.start": "Start Replay",
    "board.replay.btn.stop": "Stop Replay",
    "board.replay.btn.prev": "Prev Turn",
    "board.replay.btn.next": "Next Turn",
    "board.replay.btn.autoStart": "Auto Play",
    "board.replay.btn.autoStop": "Stop Auto",
    "board.replay.interval": "Auto interval",
    "board.replay.empty": "No kibo data. Replay cannot start.",
    "controls.alert.invalidReplay": "Unsupported replay format. Only the latest format (JSON object + kibo array) can be loaded.",
    "controls.alert.invalidJson": "JSON parse failed. Please check the file contents.",
    "controls.alert.resetReplayOnly": "Browser storage is not used. Only the currently loaded replay was reset.",
    "controls.button.rules": "Open Rules",
    "controls.button.cardGuide": "Card Guide",
    "controls.button.gameLog": "Game Log",
    "controls.mode.hva": "Human vs AI",
    "controls.mode.hvh": "Human vs Human",
    "controls.mode.ava": "AI vs AI",
    "controls.button.startSpecified": "Start (Seed)",
    "controls.button.startRandom": "Start New Game",
    "controls.button.loadReplay": "Load Kibo",
    "controls.button.exportReplay": "Export Kibo",
    "controls.button.resetReplay": "Reset Kibo",
    "controls.speed": "Speed",
    "controls.speed.fast": "Fast (instant)",
    "controls.speed.visual": "Visual (turn animation)",
    "controls.visualDelay": "Visual delay",
    "controls.revealAiHand": "Show AI hand",
    "controls.fixedHand": "Fix hand slots",
    "controls.language": "Language",
    "controls.language.ko": "Korean",
    "controls.language.en": "English",
    "controls.cardTheme": "Card Style",
    "controls.cardTheme.original": "Original",
    "controls.cardTheme.kFlower": "K-FLOWER",
    "overlay.notice": "Notice",
    "overlay.revealMessage": "{player} card reveal ({month})",
    "overlay.selectCard.title": "Choose Card",
    "overlay.selectCard.defaultMessage": "Choose 1 board card.",
    "overlay.remainingTime": "Time left: {seconds}s",
    "overlay.goStop.title": "Choose Go / Stop",
    "overlay.president.title": "President Choice",
    "overlay.president.stop": "End with 10 pts",
    "overlay.president.hold": "Hold-and-hit",
    "overlay.shaking.title": "Shake Choice",
    "overlay.shaking.confirm": "{player}: Declare shaking?",
    "overlay.yes": "Yes",
    "overlay.no": "No",
    "overlay.gukjin.title": "Gukjin Choice",
    "overlay.gukjin.five": "Keep as Five",
    "overlay.gukjin.junk": "Change to Double Junk",
    "overlay.roundEnd.title": "Round End",
    "overlay.result.win": "{player} wins",
    "overlay.result.draw": "Draw",
    "overlay.result.nagari": "Nagari: {reasons}",
    "overlay.result.president": "President!",
    "overlay.result.normal": "Normal end",
    "overlay.button.startSpecified": "Start with same deck",
    "overlay.button.startRandom": "Start new game",
    "popup.blocked": "Popup was blocked. Please allow popups and try again.",
    "popup.cardGuide.title": "Card Guide",
    "popup.cardGuide.meta": "Main cards are shown in rows of 8. (4 cards of month 1 + 4 cards of month 2)",
    "popup.cardGuide.mainCards": "Month 1-12 Cards",
    "popup.cardGuide.bonusCards": "Bonus Cards",
    "popup.rules.title": "Rules Summary",
    "popup.rules.meta": "Linked to README sections 1-9.",
    "popup.rules.readmeFallback": "Failed to read README rule sections (1-9).",
    "popup.gameLog.title": "Game Log",
    "popup.gameLog.meta": "Visible log lines: {count}",
    "popup.gameLog.empty": "No logs to display.",
    "popup.gameLog.hidden.starterCandidate": "Starter candidate:",
    "popup.gameLog.hidden.matchCapture": "match capture",
    "popup.gameLog.hidden.cardSelect": "choose card",
    "replay.action.initial": "Initial deal",
    "replay.action.pass": "Pass",
    "replay.action.play": "Play card (M{month} {name})",
    "replay.action.declareBomb": "Declare bomb (M{month})",
    "replay.action.flipSelect": "Flip select capture (M{month})",
    "replay.action.unknown": "Action",
    "card.alt.defaultName": "Card",
    "card.alt.format": "M{month} {name}"
  }
};

function interpolate(template, params = {}) {
  return String(template).replace(/\{(\w+)\}/g, (_, key) =>
    Object.prototype.hasOwnProperty.call(params, key) ? String(params[key]) : `{${key}}`
  );
}

export function translate(language, key, params = {}, fallback = "") {
  const lang = SUPPORTED_LANGUAGES.includes(language) ? language : DEFAULT_LANGUAGE;
  const text =
    MESSAGES[lang]?.[key] ??
    ENGINE_MESSAGES[lang]?.[key] ??
    MESSAGES[DEFAULT_LANGUAGE]?.[key] ??
    ENGINE_MESSAGES[DEFAULT_LANGUAGE]?.[key] ??
    fallback ??
    key;
  return interpolate(text, params);
}

export function makeTranslator(language) {
  return (key, params = {}, fallback = "") => translate(language, key, params, fallback);
}
